<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Catastrophe ‚Äî Free Cat Chaos Game | BrainSmacks</title>
<meta name="description" content="Play Catastrophe, a chaotic free browser game starring cats causing maximum mayhem. No download needed ‚Äî play instantly online.">
<link rel="canonical" href="https://brainsmacks.com/catastrophe/">
<meta property="og:type" content="website">
<meta property="og:title" content="Catastrophe ‚Äî Free Cat Chaos Game | BrainSmacks">
<meta property="og:description" content="Play Catastrophe, a chaotic free browser game starring cats causing maximum mayhem. No download needed ‚Äî play instantly online.">
<meta property="og:url" content="https://brainsmacks.com/catastrophe/">
<meta property="og:site_name" content="BrainSmacks">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:title" content="Catastrophe ‚Äî Free Cat Chaos Game | BrainSmacks">
<meta name="twitter:description" content="Play Catastrophe, a chaotic free browser game starring cats causing maximum mayhem. No download needed ‚Äî play instantly online.">
<style>
  @import url('https://fonts.googleapis.com/css2?family=Bangers&family=Fredoka+One&display=swap');
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    background: #1a0a2e;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    min-height: 100vh; font-family: 'Fredoka One', cursive; overflow: hidden;
  }
  #gameWrapper { position: relative; width: 960px; max-width: 100vw; }
  #topBar {
    display: flex; justify-content: space-between; align-items: center;
    padding: 6px 16px; background: linear-gradient(90deg, #ff6b35, #f7c59f, #ff6b35);
    border-radius: 12px 12px 0 0; border: 3px solid #ff6b35; border-bottom: none;
  }
  #scoreDisplay { font-family: 'Bangers', cursive; font-size: 26px; color: #1a0a2e; letter-spacing: 2px; }
  #timerDisplay { font-family: 'Bangers', cursive; font-size: 34px; color: #1a0a2e; letter-spacing: 3px; }
  #timerDisplay.danger { color: #cc0000; animation: pulse 0.5s infinite; }
  #chaosDisplay { font-family: 'Bangers', cursive; font-size: 16px; color: #1a0a2e; text-align: right; }
  #destructionDisplay { font-family: 'Bangers', cursive; font-size: 14px; color: #1a0a2e; }
  @keyframes pulse { 0%,100%{transform:scale(1)} 50%{transform:scale(1.1)} }
  canvas { display: block; border: 3px solid #ff6b35; border-top: none; cursor: none; width: 100%; height: auto; }
  #overlay {
    position: absolute; top: 0; left: 0; right: 0; bottom: 0;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    background: rgba(10, 5, 30, 0.94); border-radius: 0 0 12px 12px; z-index: 100;
  }
  #overlay h1 {
    font-family: 'Bangers', cursive; font-size: 72px; color: #ff6b35;
    letter-spacing: 6px; text-shadow: 4px 4px 0 #1a0a2e, 0 0 40px #ff4500;
    margin-bottom: 8px; animation: wobble 2s infinite;
  }
  @keyframes wobble { 0%,100%{transform:rotate(-2deg) scale(1)} 50%{transform:rotate(2deg) scale(1.05)} }
  #overlay p { color: #f7c59f; font-size: 20px; margin: 4px 0; letter-spacing: 1px; }
  #overlay .emoji-row { font-size: 44px; margin: 8px 0; }
  .btn {
    margin-top: 16px; padding: 14px 44px; font-family: 'Bangers', cursive; font-size: 30px;
    letter-spacing: 3px; background: linear-gradient(135deg, #ff6b35, #ff4500); color: white;
    border: 4px solid #ffdd00; border-radius: 50px; cursor: pointer;
    box-shadow: 0 6px 0 #cc3300, 0 0 30px rgba(255,100,0,0.5); transition: all 0.1s;
  }
  .btn:hover { transform: translateY(-3px); box-shadow: 0 9px 0 #cc3300, 0 0 50px rgba(255,100,0,0.8); }
  .btn:active { transform: translateY(3px); box-shadow: 0 3px 0 #cc3300; }
  .control-hint { display: flex; gap: 14px; margin-top: 12px; flex-wrap: wrap; justify-content: center; }
  .hint-badge {
    background: rgba(255,107,53,0.15); border: 2px solid #ff6b35;
    border-radius: 8px; padding: 4px 12px; color: #f7c59f; font-size: 14px;
  }
  #scoreCard { text-align: center; }
  #scoreCard .big-score { font-family:'Bangers',cursive; font-size:72px; color:#ffdd00; text-shadow:3px 3px 0 #ff4500; }
  #scoreCard .rank { font-size:24px; color:#f7c59f; }
  #warningBanner {
    position: absolute; top: 50px; left: 50%; transform: translateX(-50%);
    font-family: 'Bangers', cursive; font-size: 36px; pointer-events: none;
    opacity: 0; z-index: 10; white-space: nowrap; text-align: center;
    text-shadow: 0 0 20px rgba(0,0,0,0.8); transition: opacity 0.3s;
  }
  #comboDisplay {
    position: absolute; top: 90px; right: 20px; font-family: 'Bangers', cursive;
    font-size: 40px; color: #ffdd00; text-shadow: 3px 3px 0 #ff4500;
    pointer-events: none; opacity: 0; z-index: 10; transition: opacity 0.3s;
  }
  #roomLabel {
    position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%);
    font-family: 'Bangers', cursive; font-size: 20px; color: rgba(255,220,100,0.7);
    pointer-events: none; z-index: 5; text-shadow: 2px 2px 4px rgba(0,0,0,0.8);
  }
  #touchControls {
    display: none; position: fixed; bottom: 0; left: 0; right: 0; height: 140px;
    z-index: 200; pointer-events: none;
  }
  .touch-btn {
    position: absolute; width: 60px; height: 60px; border-radius: 50%;
    background: rgba(255,107,53,0.35); border: 2px solid rgba(255,107,53,0.6);
    pointer-events: auto; display: flex; align-items: center; justify-content: center;
    font-size: 24px; color: rgba(255,255,255,0.8); user-select: none; -webkit-user-select: none;
  }
  .touch-btn:active { background: rgba(255,107,53,0.6); }
  @media (max-width: 600px) {
    #overlay h1 { font-size: 42px; letter-spacing: 3px; }
    #overlay p { font-size: 16px; }
    .btn { font-size: 22px; padding: 12px 32px; }
    #topBar { padding: 4px 8px; flex-wrap: wrap; gap: 4px; }
    #scoreDisplay { font-size: 18px; }
    #timerDisplay { font-size: 24px; }
    #chaosDisplay { font-size: 13px; }
    .hint-badge { font-size: 12px; padding: 3px 8px; }
    #warningBanner { font-size: 24px; }
    #comboDisplay { font-size: 28px; }
  }
  @media (pointer: coarse) {
    #touchControls { display: block; }
  }
</style>
  <link rel="icon" type="image/svg+xml" href="/favicon.svg">
  <meta name="theme-color" content="#0e0e12">
</head>
<body>
<a href="../" style="position:fixed;top:10px;left:10px;z-index:9999;background:rgba(0,0,0,0.5);color:#fff;text-decoration:none;padding:6px 12px;border-radius:20px;font-size:14px;font-family:sans-serif;opacity:0.7;transition:opacity 0.2s" onmouseover="this.style.opacity=1" onmouseout="this.style.opacity=0.7">üè† Home</a>

<div id="gameWrapper">
  <div id="topBar">
    <div id="scoreDisplay">SCORE: <span id="scoreVal">0</span></div>
    <div id="destructionDisplay">DESTROYED: <span id="destructionVal">0%</span></div>
    <div id="timerDisplay"><span id="timerVal">120</span>s</div>
    <div id="chaosDisplay">CHAOS:<br><span id="chaosVal">üò¥ Sleeping</span></div>
  </div>
  <canvas role="img" aria-label="Catastrophe gameplay area" id="gameCanvas" width="960" height="560"></canvas>
  <div id="warningBanner"></div>
  <div id="comboDisplay"></div>
  <div id="roomLabel"></div>
  <div id="overlay">
    <h1>üê± CATASTROPHE</h1>
    <div class="emoji-row">üí• ü™¥ üè∫ üñºÔ∏è üî•</div>
    <p>You are a cat. Destroy EVERYTHING.</p>
    <p>Push, knock, scratch, climb & cause chaos!</p>
    <p style="color:#ffdd00">120 seconds. Massive house. Maximum damage. GO!</p>
    <div class="control-hint">
      <span class="hint-badge">‚Üê ‚Üí Move</span>
      <span class="hint-badge">‚Üë/Z Jump (hold=higher)</span>
      <span class="hint-badge">E Push/Scratch</span>
      <span class="hint-badge">Wall Jump off walls!</span>
      <span class="hint-badge">Double-tap ‚Üí = Pounce!</span>
      <span class="hint-badge">üßó Climb curtains!</span>
      <span class="hint-badge">üêï Beware the sleeping dog!</span>
    </div>
    <button class="btn" onclick="startGame()">START MAYHEM üòà</button>
  </div>
</div>

<div id="touchControls">
  <div class="touch-btn" style="left:20px;bottom:70px" id="tbLeft">‚óÄ</div>
  <div class="touch-btn" style="left:90px;bottom:70px" id="tbRight">‚ñ∂</div>
  <div class="touch-btn" style="right:90px;bottom:70px" id="tbJump">‚ñ≤</div>
  <div class="touch-btn" style="right:20px;bottom:70px" id="tbAction">E</div>
</div>

<script>
const canvas = document.getElementById('gameCanvas');
const ctx = canvas.getContext('2d');
const CW = 960, CH = 560;

// ===== CAT-SCALE WORLD =====
// Cat is ~24px tall. Tables ~72px, counters ~96px, doors ~160px.
// Each room ~800-1000px wide, ~600-800px tall.
const WORLD_W = 5200, WORLD_H = 1800;
const GRAVITY = 0.48;
const GROUND_Y = WORLD_H - 50;
const TILE = 24; // cat-unit reference

// ===== GAME STATE =====
let gameState = 'menu';
let score = 0, timeLeft = 120, timerInterval, animFrame;
let fireActive = false, fireSpread = 0;
let particles = [], floatingTexts = [];
let camera = { x: 0, y: 0 };
let combo = { count: 0, timer: 0, multiplier: 1, lastTime: 0 };
let totalDestructibles = 0, totalDestroyed = 0;
let puzzleState = {
  garageDoorOpen: false, atticHatchOpen: false,
  safeOpen: false, safeCombo: [0,0,0], safeTarget: [3,7,1],
  bathroomFlooded: false,
  secretRoomOpen: false, booksRemoved: 0, totalBooks: 5,
  hasLighter: false, stoveOn: false, fireStarted: false,
  cluesFound: [], boxesStacked: 0
};
let warnings = [];
let ownerWarningTriggered = false, dogWarningTriggered = false;
let dogChaseActive = false, dogX = 0, dogY = 0;
let roomDestructionMap = {};
let visitedRooms = {};
let slipperyZones = [];
let glassShards = [];

// ===== SLEEPING DOG =====
let sleepingDog = {
  x: 500, y: GROUND_Y - 60, w: 80, h: 50,
  active: true, state: 'sleeping',
  detectionRadius: 180, detectionMeter: 0,
  snoreTimer: 0, breathScale: 0, zzzParticles: [],
  alertTimer: 0, chaseVx: 0, barkTimer: 0, legAnim: 0,
  exclamationTimer: 0, bonked: false, bonkTimer: 0, fleeX: 0, fleeDir: 0
};

// ===== AUDIO =====
let audioCtx;
function initAudio() { audioCtx = new (window.AudioContext || window.webkitAudioContext)(); }
function playSound(type) {
  if (!audioCtx) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  gain.gain.value = 0.15;
  const t = audioCtx.currentTime;
  switch(type) {
    case 'smash':
      osc.type='sawtooth'; osc.frequency.value=200+Math.random()*200;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.15); osc.start(); osc.stop(t+0.15); break;
    case 'glass':
      osc.type='square'; osc.frequency.value=1200+Math.random()*800;
      gain.gain.value=0.1; gain.gain.exponentialRampToValueAtTime(0.01,t+0.2); osc.start(); osc.stop(t+0.2); break;
    case 'splash':
      osc.type='sine'; osc.frequency.value=300+Math.random()*200;
      gain.gain.value=0.08; gain.gain.exponentialRampToValueAtTime(0.01,t+0.3); osc.start(); osc.stop(t+0.3); break;
    case 'shred':
      osc.type='sawtooth'; osc.frequency.value=400+Math.random()*600;
      gain.gain.value=0.06; gain.gain.exponentialRampToValueAtTime(0.01,t+0.25); osc.start(); osc.stop(t+0.25); break;
    case 'scratch':
      osc.type='sawtooth'; osc.frequency.value=800+Math.random()*400;
      gain.gain.value=0.08; gain.gain.exponentialRampToValueAtTime(0.01,t+0.3); osc.start(); osc.stop(t+0.3); break;
    case 'jump':
      osc.type='sine'; osc.frequency.value=300;
      osc.frequency.exponentialRampToValueAtTime(600,t+0.1);
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.12); osc.start(); osc.stop(t+0.12); break;
    case 'pounce':
      osc.type='square'; osc.frequency.value=150;
      osc.frequency.exponentialRampToValueAtTime(400,t+0.08);
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.1); osc.start(); osc.stop(t+0.1); break;
    case 'combo':
      osc.type='sine'; osc.frequency.value=500+combo.count*100;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.2); osc.start(); osc.stop(t+0.2); break;
    case 'fire':
      osc.type='sawtooth'; osc.frequency.value=100; gain.gain.value=0.2;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.5); osc.start(); osc.stop(t+0.5); break;
    case 'unlock':
      osc.type='sine'; osc.frequency.value=400;
      osc.frequency.exponentialRampToValueAtTime(800,t+0.3);
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.35); osc.start(); osc.stop(t+0.35); break;
    case 'water':
      osc.type='sine'; osc.frequency.value=200+Math.random()*100;
      gain.gain.value=0.06; gain.gain.exponentialRampToValueAtTime(0.01,t+0.4); osc.start(); osc.stop(t+0.4); break;
    case 'warning':
      osc.type='square'; osc.frequency.value=600; gain.gain.value=0.12;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.5); osc.start(); osc.stop(t+0.5); break;
    case 'legendary':
      osc.type='sine'; osc.frequency.value=300;
      osc.frequency.linearRampToValueAtTime(900,t+0.5); gain.gain.value=0.2;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.6); osc.start(); osc.stop(t+0.6); break;
    case 'climb':
      osc.type='triangle'; osc.frequency.value=600;
      osc.frequency.linearRampToValueAtTime(900,t+0.15); gain.gain.value=0.07;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.2); osc.start(); osc.stop(t+0.2); break;
    case 'push':
      osc.type='triangle'; osc.frequency.value=80; gain.gain.value=0.1;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.15); osc.start(); osc.stop(t+0.15); break;
    case 'unroll':
      osc.type='sine'; osc.frequency.value=200;
      osc.frequency.linearRampToValueAtTime(100,t+0.4); gain.gain.value=0.06;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.4); osc.start(); osc.stop(t+0.4); break;
  }
}
function playDogSound(type) {
  if (!audioCtx) return;
  const osc = audioCtx.createOscillator();
  const gain = audioCtx.createGain();
  osc.connect(gain); gain.connect(audioCtx.destination);
  const t = audioCtx.currentTime;
  switch(type) {
    case 'snore':
      osc.type='sine'; osc.frequency.value=60+Math.random()*20; gain.gain.value=0.06;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.8); osc.start(); osc.stop(t+0.8); break;
    case 'growl':
      osc.type='sawtooth'; osc.frequency.value=80;
      osc.frequency.linearRampToValueAtTime(120,t+0.4); gain.gain.value=0.12;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.5); osc.start(); osc.stop(t+0.5); break;
    case 'bark':
      osc.type='square'; osc.frequency.value=200;
      osc.frequency.exponentialRampToValueAtTime(400,t+0.05);
      osc.frequency.exponentialRampToValueAtTime(150,t+0.12); gain.gain.value=0.18;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.15); osc.start(); osc.stop(t+0.15); break;
    case 'yelp':
      osc.type='sine'; osc.frequency.value=400;
      osc.frequency.exponentialRampToValueAtTime(800,t+0.1);
      osc.frequency.exponentialRampToValueAtTime(300,t+0.25); gain.gain.value=0.15;
      gain.gain.exponentialRampToValueAtTime(0.01,t+0.3); osc.start(); osc.stop(t+0.3); break;
  }
}

// ===== INPUT =====
const keys = {};
let lastDirTap = { dir: 0, time: 0 };
let touchState = { left:false, right:false, jump:false, action:false };

document.addEventListener('keydown', e => {
  if (['ArrowLeft','ArrowRight','ArrowUp','ArrowDown','Space','KeyZ','KeyW','KeyA','KeyD','KeyE','KeyS'].includes(e.code)) e.preventDefault();
  if (!keys[e.code]) {
    const now = Date.now();
    if ((e.code==='ArrowRight'||e.code==='KeyD') && lastDirTap.dir===1 && now-lastDirTap.time<250) cat.pounce=1;
    else if ((e.code==='ArrowLeft'||e.code==='KeyA') && lastDirTap.dir===-1 && now-lastDirTap.time<250) cat.pounce=-1;
    if (e.code==='ArrowRight'||e.code==='KeyD') lastDirTap={dir:1,time:now};
    if (e.code==='ArrowLeft'||e.code==='KeyA') lastDirTap={dir:-1,time:now};
  }
  keys[e.code] = true;
});
document.addEventListener('keyup', e => {
  keys[e.code] = false;
  if (e.code==='ArrowUp'||e.code==='KeyZ'||e.code==='KeyW'||e.code==='Space') cat.jumpReleased=true;
});

// Touch controls
function setupTouch() {
  const bind = (id, key) => {
    const el = document.getElementById(id);
    if (!el) return;
    el.addEventListener('touchstart', e => { e.preventDefault(); keys[key]=true; touchState[id.replace('tb','').toLowerCase()]=true; }, {passive:false});
    el.addEventListener('touchend', e => { e.preventDefault(); keys[key]=false; touchState[id.replace('tb','').toLowerCase()]=false;
      if(key==='ArrowUp') cat.jumpReleased=true; }, {passive:false});
  };
  bind('tbLeft','ArrowLeft'); bind('tbRight','ArrowRight'); bind('tbJump','ArrowUp'); bind('tbAction','KeyE');
}

// ===== ROOMS =====
// Cat-scale: rooms are ~900-1100px wide, ~700px tall. Cat is 24px tall.
const rooms = [
  { name:'Living Room',  x:0,    y:1100, w:1000, h:700, floor:'#8B6F47', wall:'#f5e6c8', wallAccent:'rgba(200,180,130,0.3)' },
  { name:'Kitchen',      x:1000, y:1100, w:900,  h:700, floor:'#d4c4a8', wall:'#fff8e7', wallAccent:'rgba(180,160,120,0.2)' },
  { name:'Bathroom',     x:0,    y:400,  w:700,  h:700, floor:'#b8d4e3', wall:'#e8f4f8', wallAccent:'rgba(150,200,220,0.2)' },
  { name:'Hallway',      x:700,  y:400,  w:300,  h:700, floor:'#a08060', wall:'#e8d8c0', wallAccent:'rgba(180,150,120,0.2)' },
  { name:'Bedroom',      x:1000, y:400,  w:900,  h:700, floor:'#c9a87c', wall:'#f0e0d0', wallAccent:'rgba(200,170,140,0.2)' },
  { name:'Garage',       x:2800, y:1100, w:900,  h:700, floor:'#808080', wall:'#c0c0c0', wallAccent:'rgba(100,100,100,0.15)' },
  { name:'Laundry',      x:1900, y:1100, w:900,  h:700, floor:'#c8d8c8', wall:'#e8f0e8', wallAccent:'rgba(150,180,150,0.2)' },
  { name:'Attic',        x:300,  y:0,    w:1000, h:400, floor:'#a08060', wall:'#d4c0a0', wallAccent:'rgba(160,130,90,0.2)' },
  { name:'Secret Room',  x:1900, y:400,  w:800,  h:700, floor:'#4a0080', wall:'#2a0050', wallAccent:'rgba(100,0,180,0.15)' },
];

function getRoomAt(x, y) {
  for (const r of rooms) {
    if (r.name==='Secret Room' && !puzzleState.secretRoomOpen) continue;
    if (r.name==='Attic' && !puzzleState.atticHatchOpen) continue;
    if (x>=r.x && x<r.x+r.w && y>=r.y && y<r.y+r.h) return r;
  }
  return rooms[0];
}

// ===== WALLS & PLATFORMS =====
let walls = [], platforms = [];

// Moveable furniture
let furniture = [];

function initLevel() {
  walls = [
    // Ground
    { x:0, y:GROUND_Y, w:WORLD_W, h:50, solid:true, color:'#5a4a30' },
    // Left wall
    { x:-20, y:-50, w:20, h:WORLD_H+100, solid:true, color:'#8B7355' },
    // Right wall
    { x:3700, y:400, w:20, h:1500, solid:true, color:'#8B7355' },

    // === Ground floor walls ===
    // Living/Kitchen divider
    { x:990, y:1100, w:20, h:300, solid:true, color:'#c8a87a' },
    { x:990, y:1560, w:20, h:240, solid:true, color:'#c8a87a' },
    // Kitchen/Laundry divider
    { x:1890, y:1100, w:20, h:280, solid:true, color:'#c8a87a' },
    { x:1890, y:1540, w:20, h:260, solid:true, color:'#c8a87a' },
    // Laundry/Garage divider (garage door)
    // Secret Room / Garage divider
    { x:2790, y:1100, w:20, h:300, solid:true, color:'#8B7355' },
    { x:2790, y:1560, w:20, h:240, solid:true, color:'#8B7355' },
    // Garage right wall
    { x:3690, y:1100, w:20, h:700, solid:true, color:'#8B7355' },

    // === Upper floor ===
    // Floor between upper and lower
    { x:0, y:1090, w:2700, h:20, solid:true, color:'#8B6F47' },
    // Bathroom left wall
    { x:-20, y:400, w:20, h:700, solid:true, color:'#8B7355' },
    // Bathroom/Hallway divider
    { x:690, y:400, w:20, h:460, solid:true, color:'#c8a87a' },
    // Hallway/Bedroom divider
    { x:990, y:400, w:20, h:420, solid:true, color:'#c8a87a' },
    // Upper ceiling
    { x:0, y:390, w:1910, h:20, solid:true, color:'#8B7355' },
    // Bedroom right wall
    { x:1890, y:400, w:20, h:700, solid:true, color:'#8B7355' },

    // === Attic ===
    // (accessible when hatch open)

    // Baseboards
  ];

  platforms = [
    // === LIVING ROOM === (cat-scale: cat is 24px, sofa ~80px tall from ground)
    // Sofa (big, cat has to jump up)
    { x:60, y:GROUND_Y-80, w:280, h:35, color:'#A0522D', room:'Living Room', type:'sofa' },
    // Coffee table (shorter)
    { x:420, y:GROUND_Y-50, w:180, h:18, color:'#8B6914', room:'Living Room', type:'table' },
    // Wall shelves (towering high)
    { x:80, y:1320, w:200, h:16, color:'#6B4423', room:'Living Room', type:'shelf' },
    { x:700, y:1280, w:180, h:16, color:'#6B4423', room:'Living Room', type:'shelf' },
    { x:400, y:1200, w:200, h:16, color:'#6B4423', room:'Living Room', type:'shelf' },
    // TV stand
    { x:500, y:GROUND_Y-100, w:120, h:20, color:'#3a2a14', room:'Living Room', type:'tvstand' },
    // Bookshelf (blocks secret room passage)
    { x:1890, y:410, w:30, h:690, color:'#5a3a1a', room:'Secret Room', type:'bookshelf', blocksSecret:true },

    // === KITCHEN ===
    // Counter left (tall for cat - ~96px)
    { x:1020, y:GROUND_Y-96, w:250, h:20, color:'#C0A882', room:'Kitchen', type:'counter' },
    // Counter right
    { x:1400, y:GROUND_Y-96, w:250, h:20, color:'#C0A882', room:'Kitchen', type:'counter' },
    // Kitchen table
    { x:1200, y:GROUND_Y-72, w:160, h:16, color:'#8B6914', room:'Kitchen', type:'table' },
    // Upper cabinet shelf
    { x:1050, y:1250, w:180, h:14, color:'#8B6F47', room:'Kitchen', type:'shelf' },
    // Stove
    { x:1650, y:GROUND_Y-96, w:120, h:40, color:'#7f8c8d', room:'Kitchen', type:'stove' },
    // Fridge top (very high)
    { x:1020, y:1200, w:80, h:14, color:'#bdc3c7', room:'Kitchen', type:'shelf' },
    // Stepping stool
    { x:1350, y:GROUND_Y-36, w:50, h:14, color:'#a08060', room:'Kitchen', type:'stool' },

    // === BATHROOM ===
    // Sink counter
    { x:50, y:880, w:180, h:20, color:'#d4e6f1', room:'Bathroom', type:'counter' },
    // Bathtub rim
    { x:380, y:940, w:250, h:16, color:'#ecf0f1', room:'Bathroom', type:'tub' },
    // Shelf above toilet
    { x:80, y:660, w:160, h:14, color:'#bdc3c7', room:'Bathroom', type:'shelf' },
    // Towel rack
    { x:500, y:720, w:120, h:12, color:'#7f8c8d', room:'Bathroom', type:'shelf' },
    // Toilet (cat can jump on)
    { x:260, y:980, w:70, h:30, color:'#ecf0f1', room:'Bathroom', type:'toilet' },

    // === HALLWAY ===
    { x:720, y:780, w:130, h:14, color:'#6B4423', room:'Hallway', type:'shelf' },
    // Stairs down to ground floor
    { x:750, y:900, w:100, h:16, color:'#8B6F47', room:'Hallway', type:'stair' },
    { x:800, y:960, w:100, h:16, color:'#8B6F47', room:'Hallway', type:'stair' },
    { x:850, y:1020, w:100, h:16, color:'#8B6F47', room:'Hallway', type:'stair' },

    // === BEDROOM ===
    // Bed (big)
    { x:1200, y:980, w:300, h:40, color:'#6a5acd', room:'Bedroom', type:'bed' },
    // Desk
    { x:1050, y:860, w:160, h:18, color:'#8B6914', room:'Bedroom', type:'desk' },
    // High shelf
    { x:1600, y:620, w:180, h:16, color:'#6B4423', room:'Bedroom', type:'shelf' },
    // Nightstand
    { x:1520, y:1000, w:70, h:24, color:'#5a3a1a', room:'Bedroom', type:'table' },
    // Dresser (tall)
    { x:1030, y:950, w:100, h:70, color:'#8B6F47', room:'Bedroom', type:'dresser' },
    // Window sill (high, curtain access)
    { x:1300, y:560, w:200, h:14, color:'#c8a87a', room:'Bedroom', type:'windowsill' },

    // === LAUNDRY ===
    // Washer top
    { x:1940, y:GROUND_Y-90, w:120, h:16, color:'#bdc3c7', room:'Laundry', type:'appliance' },
    // Dryer top
    { x:2080, y:GROUND_Y-90, w:120, h:16, color:'#bdc3c7', room:'Laundry', type:'appliance' },
    // Folding table
    { x:2300, y:GROUND_Y-70, w:180, h:16, color:'#8B6914', room:'Laundry', type:'table' },
    // Laundry shelf
    { x:2000, y:1280, w:200, h:14, color:'#6B4423', room:'Laundry', type:'shelf' },
    // Ironing board
    { x:2500, y:GROUND_Y-55, w:160, h:10, color:'#aaa', room:'Laundry', type:'shelf' },

    // === GARAGE ===
    // Workbench
    { x:2900, y:GROUND_Y-80, w:250, h:22, color:'#8B6F47', room:'Garage', type:'bench' },
    // High shelf
    { x:3200, y:1300, w:250, h:18, color:'#7f8c8d', room:'Garage', type:'shelf' },
    // Car hood
    { x:3000, y:GROUND_Y-140, w:350, h:22, color:'#c0392b', room:'Garage', type:'car' },
    // Step ladder
    { x:3500, y:GROUND_Y-50, w:60, h:16, color:'#a08060', room:'Garage', type:'stool' },
    { x:3510, y:GROUND_Y-100, w:50, h:16, color:'#a08060', room:'Garage', type:'stool' },

    // === ATTIC ===
    { x:320, y:380, w:960, h:18, color:'#8B6F47', room:'Attic', type:'beam' },
    { x:350, y:200, w:200, h:16, color:'#6B4423', room:'Attic', type:'shelf' },
    { x:850, y:180, w:220, h:16, color:'#6B4423', room:'Attic', type:'shelf' },
    { x:550, y:280, w:250, h:14, color:'#8B6F47', room:'Attic', type:'beam' },

    // === SECRET ROOM ===
    { x:2100, y:880, w:100, h:30, color:'#4a0080', room:'Secret Room', type:'pedestal' },
    { x:2000, y:700, w:180, h:16, color:'#6a0090', room:'Secret Room', type:'shelf' },
    { x:2400, y:620, w:160, h:16, color:'#6a0090', room:'Secret Room', type:'shelf' },
  ];

  // === MOVEABLE FURNITURE ===
  furniture = [
    // Living Room
    { x:350, y:GROUND_Y-40, w:50, h:40, color:'#C19A6B', label:'Ottoman', heavy:false, pushable:true, vx:0, vy:0, onGround:false, hidesItem:null },
    { x:750, y:GROUND_Y-55, w:40, h:55, color:'#8B6914', label:'Chair', heavy:false, pushable:true, vx:0, vy:0, onGround:false, hidesItem:null },
    { x:900, y:GROUND_Y-30, w:30, h:20, color:'#654321', label:'Shoes', heavy:false, pushable:true, vx:0, vy:0, onGround:false, hidesItem:'clue1' },
    // Kitchen
    { x:1300, y:GROUND_Y-55, w:40, h:55, color:'#8B6914', label:'Kitchen Chair', heavy:false, pushable:true, vx:0, vy:0, onGround:false },
    { x:1550, y:GROUND_Y-30, w:36, h:30, color:'#a0522d', label:'Box', heavy:false, pushable:true, vx:0, vy:0, onGround:false },
    // Hallway
    { x:770, y:1060, w:40, h:30, color:'#654321', label:'Shoes', heavy:false, pushable:true, vx:0, vy:0, onGround:false },
    // Bedroom
    { x:1700, y:980, w:50, h:40, color:'#C19A6B', label:'Ottoman', heavy:false, pushable:true, vx:0, vy:0, onGround:false },
    { x:1800, y:1060, w:30, h:20, color:'#8B4513', label:'Slippers', heavy:false, pushable:true, vx:0, vy:0, onGround:false },
    // Laundry
    { x:2250, y:GROUND_Y-36, w:40, h:36, color:'#ddd', label:'Laundry Basket', heavy:false, pushable:true, vx:0, vy:0, onGround:false },
    { x:2600, y:GROUND_Y-30, w:36, h:30, color:'#a0522d', label:'Box', heavy:false, pushable:true, vx:0, vy:0, onGround:false, hidesItem:'passage_garage' },
    // Garage
    { x:3550, y:GROUND_Y-30, w:36, h:30, color:'#a0522d', label:'Crate', heavy:false, pushable:true, vx:0, vy:0, onGround:false },
    { x:3400, y:GROUND_Y-36, w:36, h:36, color:'#8B4513', label:'Toolbox', heavy:false, pushable:true, vx:0, vy:0, onGround:false },
  ];
}

// ===== CURTAINS (Climbable, one-time use) =====
let curtains = [];
function initCurtains() {
  curtains = [
    // Living Room windows
    { x:120, y:1180, w:35, h:300, room:'Living Room', shredded:false, climbed:false, color:'#c0392b',
      topY:1180, windowX:130, windowY:1190, windowW:140, windowH:120 },
    { x:800, y:1180, w:35, h:300, room:'Living Room', shredded:false, climbed:false, color:'#c0392b',
      topY:1180, windowX:810, windowY:1190, windowW:140, windowH:120 },
    // Bedroom windows
    { x:1300, y:500, w:35, h:300, room:'Bedroom', shredded:false, climbed:false, color:'#2c3e50',
      topY:500, windowX:1310, windowY:510, windowW:180, windowH:140 },
    { x:1700, y:500, w:35, h:300, room:'Bedroom', shredded:false, climbed:false, color:'#2c3e50',
      topY:500, windowX:1710, windowY:510, windowW:140, windowH:120 },
    // Bathroom
    { x:200, y:520, w:30, h:250, room:'Bathroom', shredded:false, climbed:false, color:'#3498db',
      topY:520, windowX:210, windowY:530, windowW:120, windowH:100 },
    // Laundry
    { x:2400, y:1180, w:35, h:300, room:'Laundry', shredded:false, climbed:false, color:'#27ae60',
      topY:1180, windowX:2410, windowY:1190, windowW:140, windowH:120 },
  ];
}

// ===== CAT =====
let cat = {
  x:150, y:GROUND_Y-30, w:24, h:22,
  vx:0, vy:0, onGround:false, facing:1,
  state:'idle', frame:0, frameTimer:0,
  eHeld:0, pushCooldown:0, tail:0,
  jumpHeld:false, jumpReleased:false, jumpTime:0,
  wallSlide:0, pounce:0, pounceTimer:0,
  squish:0, stretch:0, puffTail:0,
  scratchTarget:null, scratchProgress:0,
  climbing:null, climbY:0, climbTimer:0
};

// ===== OBJECTS =====
let objects = [];

function initObjects() {
  totalDestroyed = 0;
  objects = [
    // ===== LIVING ROOM =====
    // On coffee table
    { id:'glass1', room:'Living Room', type:'glass', x:440, y:GROUND_Y-68, w:10, h:16, destroyed:false, pts:1, color:'#a8d8ea', label:'Glass', pushable:true, vx:0, vy:0, smashable:true },
    { id:'glass2', room:'Living Room', type:'glass', x:480, y:GROUND_Y-68, w:10, h:16, destroyed:false, pts:1, color:'#a8d8ea', label:'Glass', pushable:true, vx:0, vy:0, smashable:true },
    { id:'mug1', room:'Living Room', type:'glass', x:520, y:GROUND_Y-70, w:12, h:18, destroyed:false, pts:1, color:'#e07a5f', label:'Mug', pushable:true, vx:0, vy:0, smashable:true },
    { id:'remote', room:'Living Room', type:'book', x:560, y:GROUND_Y-56, w:18, h:6, destroyed:false, pts:2, color:'#333', label:'TV Remote', pushable:true, vx:0, vy:0, smashable:false },
    { id:'magazine1', room:'Living Room', type:'book', x:460, y:GROUND_Y-56, w:16, h:10, destroyed:false, pts:1, color:'#e74c3c', label:'Magazine', pushable:true, vx:0, vy:0, smashable:false },
    { id:'coaster1', room:'Living Room', type:'glass', x:500, y:GROUND_Y-54, w:10, h:4, destroyed:false, pts:1, color:'#8B6914', label:'Coaster', pushable:true, vx:0, vy:0, smashable:false },
    { id:'coaster2', room:'Living Room', type:'glass', x:540, y:GROUND_Y-54, w:10, h:4, destroyed:false, pts:1, color:'#8B6914', label:'Coaster', pushable:true, vx:0, vy:0, smashable:false },
    // On sofa
    { id:'pillow1', room:'Living Room', type:'pillow', x:100, y:GROUND_Y-100, w:28, h:20, destroyed:false, pts:2, color:'#e056da', label:'Pillow', pushable:true, vx:0, vy:0, smashable:false, shreddable:true },
    { id:'pillow2', room:'Living Room', type:'pillow', x:260, y:GROUND_Y-100, w:28, h:20, destroyed:false, pts:2, color:'#fdcb6e', label:'Pillow', pushable:true, vx:0, vy:0, smashable:false, shreddable:true },
    // Shelves
    { id:'vase1', room:'Living Room', type:'vase', x:120, y:1300, w:16, h:24, destroyed:false, pts:3, color:'#6a9ebc', label:'Vase', pushable:true, vx:0, vy:0, smashable:true },
    { id:'plant1', room:'Living Room', type:'plant', x:730, y:1256, w:20, h:28, destroyed:false, pts:3, color:'#4a7c59', label:'Plant Pot', pushable:true, vx:0, vy:0, smashable:true },
    { id:'frame1', room:'Living Room', type:'painting', x:300, y:1220, w:60, h:45, destroyed:false, pts:5, color:'#e8daef', label:'Picture Frame', fixed:true, scratchable:true, scratchTime:20 },
    { id:'candle1', room:'Living Room', type:'glass', x:200, y:1304, w:8, h:18, destroyed:false, pts:2, color:'#f5f5dc', label:'Candle', pushable:true, vx:0, vy:0, smashable:true },
    { id:'candle2', room:'Living Room', type:'glass', x:850, y:1264, w:8, h:18, destroyed:false, pts:2, color:'#f5f5dc', label:'Candle', pushable:true, vx:0, vy:0, smashable:true },
    // High shelf
    { id:'book_lr1', room:'Living Room', type:'book', x:420, y:1186, w:18, h:12, destroyed:false, pts:2, color:'#e74c3c', label:'Book', pushable:true, vx:0, vy:0, smashable:false },
    { id:'book_lr2', room:'Living Room', type:'book', x:450, y:1186, w:18, h:12, destroyed:false, pts:2, color:'#3498db', label:'Book', pushable:true, vx:0, vy:0, smashable:false },
    // TV
    { id:'tv', room:'Living Room', type:'tv', x:510, y:GROUND_Y-140, w:100, h:50, destroyed:false, pts:10, color:'#2c3e50', label:'HDTV', pushable:true, vx:0, vy:0, smashable:true, heavy:true },
    // Painting (scratchable)
    { id:'painting', room:'Living Room', type:'painting', x:500, y:1180, w:90, h:70, destroyed:false, pts:12, color:'#8e44ad', label:'Priceless Painting', fixed:true, scratchable:true, scratchTime:40 },
    // Plant pot on floor
    { id:'plant2', room:'Living Room', type:'plant', x:950, y:GROUND_Y-30, w:22, h:30, destroyed:false, pts:3, color:'#2d6a4f', label:'Floor Plant', pushable:true, vx:0, vy:0, smashable:true },

    // Bookshelf books (5 to reveal secret room)
    { id:'bk1', room:'Living Room', type:'book', x:1895, y:430, w:20, h:14, destroyed:false, pts:2, color:'#8e44ad', label:'Book', pushable:true, vx:0, vy:0, smashable:false, isBookshelfBook:true },
    { id:'bk2', room:'Living Room', type:'book', x:1895, y:470, w:20, h:14, destroyed:false, pts:2, color:'#e74c3c', label:'Book', pushable:true, vx:0, vy:0, smashable:false, isBookshelfBook:true },
    { id:'bk3', room:'Living Room', type:'book', x:1895, y:510, w:20, h:14, destroyed:false, pts:2, color:'#2ecc71', label:'Book', pushable:true, vx:0, vy:0, smashable:false, isBookshelfBook:true },
    { id:'bk4', room:'Living Room', type:'book', x:1895, y:550, w:20, h:14, destroyed:false, pts:2, color:'#f39c12', label:'Book', pushable:true, vx:0, vy:0, smashable:false, isBookshelfBook:true },
    { id:'bk5', room:'Living Room', type:'book', x:1895, y:590, w:20, h:14, destroyed:false, pts:2, color:'#3498db', label:'Book', pushable:true, vx:0, vy:0, smashable:false, isBookshelfBook:true },

    // Clue note 1
    { id:'clue1', room:'Living Room', type:'clue', x:200, y:1306, w:14, h:10, destroyed:false, pts:0, color:'#ffffcc', label:'Note: "First digit: 3"', collectable:true, clueIndex:0, clueValue:3 },

    // ===== KITCHEN =====
    // Counter items
    { id:'plate1', room:'Kitchen', type:'glass', x:1040, y:GROUND_Y-114, w:18, h:8, destroyed:false, pts:2, color:'#ecf0f1', label:'Plate', pushable:true, vx:0, vy:0, smashable:true },
    { id:'plate2', room:'Kitchen', type:'glass', x:1080, y:GROUND_Y-114, w:18, h:8, destroyed:false, pts:2, color:'#ecf0f1', label:'Plate', pushable:true, vx:0, vy:0, smashable:true },
    { id:'bowl1', room:'Kitchen', type:'glass', x:1120, y:GROUND_Y-116, w:16, h:12, destroyed:false, pts:2, color:'#d4e6f1', label:'Bowl', pushable:true, vx:0, vy:0, smashable:true },
    { id:'cup1', room:'Kitchen', type:'glass', x:1160, y:GROUND_Y-116, w:10, h:14, destroyed:false, pts:1, color:'#87ceeb', label:'Cup', pushable:true, vx:0, vy:0, smashable:true },
    { id:'cup2', room:'Kitchen', type:'glass', x:1200, y:GROUND_Y-116, w:10, h:14, destroyed:false, pts:1, color:'#87ceeb', label:'Cup', pushable:true, vx:0, vy:0, smashable:true },
    { id:'vase_k', room:'Kitchen', type:'vase', x:1420, y:GROUND_Y-120, w:14, h:24, destroyed:false, pts:3, color:'#e8daef', label:'Vase', pushable:true, vx:0, vy:0, smashable:true },
    { id:'spicerack', room:'Kitchen', type:'glass', x:1480, y:GROUND_Y-116, w:30, h:20, destroyed:false, pts:4, color:'#d4a574', label:'Spice Rack', pushable:true, vx:0, vy:0, smashable:true },
    { id:'blender', room:'Kitchen', type:'glass', x:1540, y:GROUND_Y-120, w:16, h:26, destroyed:false, pts:3, color:'#95a5a6', label:'Blender', pushable:true, vx:0, vy:0, smashable:true },
    { id:'fruitbowl', room:'Kitchen', type:'glass', x:1600, y:GROUND_Y-114, w:24, h:16, destroyed:false, pts:3, color:'#f39c12', label:'Fruit Bowl', pushable:true, vx:0, vy:0, smashable:true },
    { id:'papertowel', room:'Kitchen', type:'tp', x:1250, y:GROUND_Y-118, w:14, h:22, destroyed:false, pts:2, color:'#ecf0f1', label:'Paper Towel', pushable:true, vx:0, vy:0, smashable:false, unrollable:true },
    // On table
    { id:'glass_k1', room:'Kitchen', type:'glass', x:1220, y:GROUND_Y-90, w:10, h:16, destroyed:false, pts:1, color:'#a8d8ea', label:'Glass', pushable:true, vx:0, vy:0, smashable:true },
    { id:'plant_k', room:'Kitchen', type:'plant', x:1280, y:GROUND_Y-96, w:18, h:24, destroyed:false, pts:3, color:'#2d6a4f', label:'Herb Plant', pushable:true, vx:0, vy:0, smashable:true },
    // Stove
    { id:'stoveknob', room:'Kitchen', type:'stoveknob', x:1690, y:GROUND_Y-86, w:14, h:14, destroyed:false, pts:5, color:'#e74c3c', label:'Stove Knob', fixed:true, interactive:true },
    // Upper shelf
    { id:'bowl_k2', room:'Kitchen', type:'glass', x:1070, y:1236, w:16, h:12, destroyed:false, pts:2, color:'#d4e6f1', label:'Bowl', pushable:true, vx:0, vy:0, smashable:true },
    { id:'mug_k', room:'Kitchen', type:'glass', x:1140, y:1236, w:12, h:16, destroyed:false, pts:1, color:'#e07a5f', label:'Mug', pushable:true, vx:0, vy:0, smashable:true },

    // Clue 2
    { id:'clue2', room:'Kitchen', type:'clue', x:1100, y:1238, w:14, h:10, destroyed:false, pts:0, color:'#ffffcc', label:'Note: "Second digit: 7"', collectable:true, clueIndex:1, clueValue:7 },
    // Garage opener
    { id:'garagebtn', room:'Kitchen', type:'button', x:1850, y:GROUND_Y-50, w:20, h:20, destroyed:false, pts:0, color:'#2ecc71', label:'Garage Opener', fixed:true, interactive:true },

    // ===== BATHROOM =====
    // Toilet paper
    { id:'tp1', room:'Bathroom', type:'tp', x:280, y:960, w:16, h:16, destroyed:false, pts:2, color:'#ecf0f1', label:'Toilet Paper', pushable:true, vx:0, vy:0, smashable:false, unrollable:true },
    // Sink items
    { id:'soap', room:'Bathroom', type:'glass', x:80, y:862, w:10, h:12, destroyed:false, pts:1, color:'#ff9ff3', label:'Soap Dispenser', pushable:true, vx:0, vy:0, smashable:true },
    { id:'tp2', room:'Bathroom', type:'tp', x:120, y:864, w:14, h:14, destroyed:false, pts:1, color:'#ecf0f1', label:'Toilet Paper', pushable:true, vx:0, vy:0, smashable:false },
    // Towels
    { id:'towel1', room:'Bathroom', type:'pillow', x:510, y:712, w:30, h:14, destroyed:false, pts:2, color:'#3498db', label:'Towel', pushable:true, vx:0, vy:0, smashable:false },
    { id:'towel2', room:'Bathroom', type:'pillow', x:550, y:712, w:30, h:14, destroyed:false, pts:2, color:'#e74c3c', label:'Towel', pushable:true, vx:0, vy:0, smashable:false },
    // Shelf items
    { id:'shampoo', room:'Bathroom', type:'glass', x:100, y:646, w:10, h:18, destroyed:false, pts:2, color:'#2ecc71', label:'Shampoo', pushable:true, vx:0, vy:0, smashable:true },
    { id:'perfume', room:'Bathroom', type:'glass', x:150, y:646, w:8, h:16, destroyed:false, pts:3, color:'#9b59b6', label:'Perfume', pushable:true, vx:0, vy:0, smashable:true },
    // Mirror
    { id:'mirror', room:'Bathroom', type:'painting', x:120, y:680, w:70, h:55, destroyed:false, pts:5, color:'#d5f5e3', label:'Mirror', fixed:true, scratchable:true, scratchTime:25 },
    // Faucet
    { id:'faucet', room:'Bathroom', type:'faucet', x:450, y:930, w:20, h:16, destroyed:false, pts:5, color:'#bdc3c7', label:'Faucet (knock it!)', pushable:true, vx:0, vy:0, smashable:false, isFaucet:true },
    // Shower curtain (scratchable)
    { id:'showercurtain', room:'Bathroom', type:'curtain', x:620, y:600, w:30, h:400, destroyed:false, pts:4, color:'#ecf0f1', label:'Shower Curtain', scratchable:true, scratchTime:20 },

    // ===== HALLWAY =====
    { id:'vase_h', room:'Hallway', type:'vase', x:740, y:766, w:16, h:20, destroyed:false, pts:3, color:'#e8daef', label:'Hallway Vase', pushable:true, vx:0, vy:0, smashable:true },
    { id:'clue3', room:'Hallway', type:'clue', x:780, y:770, w:14, h:10, destroyed:false, pts:0, color:'#ffffcc', label:'Note: "Third digit: 1"', collectable:true, clueIndex:2, clueValue:1 },

    // ===== BEDROOM =====
    // On bed
    { id:'pillow_b1', room:'Bedroom', type:'pillow', x:1220, y:960, w:26, h:18, destroyed:false, pts:2, color:'#a29bfe', label:'Pillow', pushable:true, vx:0, vy:0, smashable:false, shreddable:true },
    { id:'pillow_b2', room:'Bedroom', type:'pillow', x:1440, y:960, w:26, h:18, destroyed:false, pts:2, color:'#fd79a8', label:'Pillow', pushable:true, vx:0, vy:0, smashable:false, shreddable:true },
    // Desk items
    { id:'keyboard', room:'Bedroom', type:'keyboard', x:1070, y:844, w:50, h:12, destroyed:false, pts:3, color:'#bdc3c7', label:'Keyboard', pushable:true, vx:0, vy:0, smashable:false },
    { id:'phone_charger', room:'Bedroom', type:'glass', x:1140, y:844, w:8, h:14, destroyed:false, pts:2, color:'#333', label:'Phone Charger', pushable:true, vx:0, vy:0, smashable:false },
    // Nightstand items
    { id:'lamp_b', room:'Bedroom', type:'lamp', x:1540, y:976, w:14, h:28, destroyed:false, pts:3, color:'#f9ca24', label:'Lamp', pushable:true, vx:0, vy:0, smashable:true },
    { id:'alarm', room:'Bedroom', type:'glass', x:1560, y:982, w:16, h:14, destroyed:false, pts:2, color:'#2c3e50', label:'Alarm Clock', pushable:true, vx:0, vy:0, smashable:true },
    // Dresser items
    { id:'jewelry', room:'Bedroom', type:'glass', x:1050, y:936, w:14, h:12, destroyed:false, pts:5, color:'#f1c40f', label:'Jewelry Box', pushable:true, vx:0, vy:0, smashable:true },
    // High shelf
    { id:'trophy', room:'Bedroom', type:'trophy', x:1640, y:600, w:16, h:24, destroyed:false, pts:8, color:'#f1c40f', label:'Trophy', pushable:true, vx:0, vy:0, smashable:true },
    { id:'fishbowl', room:'Bedroom', type:'fishbowl', x:1700, y:596, w:26, h:24, destroyed:false, pts:8, color:'#85c1e9', label:'Fishbowl üê†', pushable:true, vx:0, vy:0, smashable:true },
    // Books on shelf
    { id:'book_b1', room:'Bedroom', type:'book', x:1620, y:606, w:16, h:12, destroyed:false, pts:2, color:'#e74c3c', label:'Book', pushable:true, vx:0, vy:0, smashable:false },
    { id:'book_b2', room:'Bedroom', type:'book', x:1660, y:606, w:16, h:12, destroyed:false, pts:2, color:'#3498db', label:'Book', pushable:true, vx:0, vy:0, smashable:false },
    // Wedding photo
    { id:'photo_b', room:'Bedroom', type:'painting', x:1150, y:520, w:70, h:50, destroyed:false, pts:5, color:'#e8daef', label:'Wedding Photo', fixed:true, scratchable:true, scratchTime:20 },
    // Safe
    { id:'safe', room:'Bedroom', type:'safe', x:1800, y:1040, w:55, h:45, destroyed:false, pts:0, color:'#2c3e50', label:'Safe [E]', fixed:true, interactive:true },
    // Attic key
    { id:'attic_key', room:'Bedroom', type:'key', x:1060, y:950, w:14, h:10, destroyed:false, pts:0, color:'#f1c40f', label:'Attic Key üîë', collectable:true },

    // ===== LAUNDRY =====
    { id:'detergent', room:'Laundry', type:'glass', x:1960, y:GROUND_Y-108, w:14, h:20, destroyed:false, pts:2, color:'#3498db', label:'Detergent', pushable:true, vx:0, vy:0, smashable:true },
    { id:'softener', room:'Laundry', type:'glass', x:2000, y:GROUND_Y-108, w:12, h:18, destroyed:false, pts:2, color:'#9b59b6', label:'Fabric Softener', pushable:true, vx:0, vy:0, smashable:true },
    { id:'iron', room:'Laundry', type:'glass', x:2520, y:GROUND_Y-68, w:18, h:14, destroyed:false, pts:3, color:'#95a5a6', label:'Iron', pushable:true, vx:0, vy:0, smashable:true },
    { id:'spray', room:'Laundry', type:'glass', x:2560, y:GROUND_Y-68, w:10, h:18, destroyed:false, pts:2, color:'#2ecc71', label:'Spray Bottle', pushable:true, vx:0, vy:0, smashable:true },
    { id:'sock1', room:'Laundry', type:'pillow', x:2320, y:GROUND_Y-86, w:14, h:10, destroyed:false, pts:1, color:'#fff', label:'Sock', pushable:true, vx:0, vy:0, smashable:false },
    { id:'sock2', room:'Laundry', type:'pillow', x:2360, y:GROUND_Y-86, w:14, h:10, destroyed:false, pts:1, color:'#e74c3c', label:'Sock', pushable:true, vx:0, vy:0, smashable:false },
    // Shelf items
    { id:'bleach', room:'Laundry', type:'glass', x:2020, y:1266, w:12, h:20, destroyed:false, pts:2, color:'#ecf0f1', label:'Bleach', pushable:true, vx:0, vy:0, smashable:true },
    { id:'basket_stuff', room:'Laundry', type:'glass', x:2100, y:1266, w:24, h:16, destroyed:false, pts:2, color:'#f39c12', label:'Clothespins', pushable:true, vx:0, vy:0, smashable:false },

    // ===== GARAGE =====
    { id:'toolbox_g', room:'Garage', type:'glass', x:2920, y:GROUND_Y-104, w:28, h:20, destroyed:false, pts:3, color:'#e74c3c', label:'Toolbox', pushable:true, vx:0, vy:0, smashable:true },
    { id:'paint', room:'Garage', type:'glass', x:3000, y:GROUND_Y-104, w:20, h:24, destroyed:false, pts:3, color:'#3498db', label:'Paint Can', pushable:true, vx:0, vy:0, smashable:true },
    { id:'oilcan', room:'Garage', type:'glass', x:3250, y:1284, w:14, h:20, destroyed:false, pts:2, color:'#2c3e50', label:'Oil Can', pushable:true, vx:0, vy:0, smashable:true },
    { id:'spraypaint', room:'Garage', type:'glass', x:3350, y:1284, w:10, h:18, destroyed:false, pts:2, color:'#e74c3c', label:'Spray Paint', pushable:true, vx:0, vy:0, smashable:true },
    // Car (scratchable)
    { id:'car', room:'Garage', type:'car_body', x:3000, y:GROUND_Y-180, w:350, h:80, destroyed:false, pts:50, color:'#c0392b', label:'CAR üöó', fixed:true, scratchable:true, scratchTime:60 },

    // ===== ATTIC =====
    { id:'lighter', room:'Attic', type:'lighter', x:400, y:184, w:12, h:16, destroyed:false, pts:0, color:'#e67e22', label:'üî• Lighter!', collectable:true },
    { id:'artifact', room:'Attic', type:'artifact', x:900, y:164, w:28, h:26, destroyed:false, pts:30, color:'#f1c40f', label:'Ancient Artifact', pushable:true, vx:0, vy:0, smashable:true },
    { id:'antique', room:'Attic', type:'trophy', x:600, y:266, w:20, h:24, destroyed:false, pts:15, color:'#e67e22', label:'Antique Urn', pushable:true, vx:0, vy:0, smashable:true },
    { id:'old_painting', room:'Attic', type:'painting', x:450, y:80, w:80, h:60, destroyed:false, pts:15, color:'#c27ba0', label:'Old Masterpiece', fixed:true, scratchable:true, scratchTime:30 },

    // ===== SECRET ROOM =====
    { id:'crystal', room:'Secret Room', type:'artifact', x:2120, y:856, w:22, h:22, destroyed:false, pts:25, color:'#9b59b6', label:'Crystal Ball', pushable:true, vx:0, vy:0, smashable:true },
    { id:'gold_vase', room:'Secret Room', type:'vase', x:2030, y:682, w:20, h:24, destroyed:false, pts:20, color:'#f1c40f', label:'Golden Vase', pushable:true, vx:0, vy:0, smashable:true },
    { id:'diamond', room:'Secret Room', type:'artifact', x:2440, y:602, w:16, h:16, destroyed:false, pts:35, color:'#85c1e9', label:'Diamond Display', pushable:true, vx:0, vy:0, smashable:true },
  ];

  totalDestructibles = objects.filter(o => o.pts > 0).length;

  roomDestructionMap = {};
  visitedRooms = {};
  for (const r of rooms) {
    const roomObjs = objects.filter(o => o.room === r.name && o.pts > 0);
    roomDestructionMap[r.name] = { total: roomObjs.length, destroyed: 0 };
  }
}

// ===== COMBO SYSTEM =====
function addCombo() {
  combo.count++;
  combo.timer = 100;
  combo.lastTime = Date.now();
  if (combo.count >= 10) combo.multiplier = 5;
  else if (combo.count >= 8) combo.multiplier = 4;
  else if (combo.count >= 5) combo.multiplier = 3;
  else if (combo.count >= 3) combo.multiplier = 2;
  else combo.multiplier = 1;
  if (combo.multiplier > 1) {
    playSound('combo');
    const el = document.getElementById('comboDisplay');
    el.textContent = `${combo.multiplier}x COMBO! (${combo.count})`;
    el.style.opacity = '1';
    el.style.color = combo.multiplier>=5?'#ff0000':combo.multiplier>=4?'#ff4500':combo.multiplier>=3?'#ff6b35':'#ffdd00';
  }
}
function updateCombo() {
  if (combo.timer > 0) {
    combo.timer--;
    if (combo.timer <= 0) { combo.count=0; combo.multiplier=1; document.getElementById('comboDisplay').style.opacity='0'; }
  }
}

// ===== SCORE =====
function addScore(pts, label, x, y) {
  const finalPts = pts * combo.multiplier;
  score += finalPts;
  document.getElementById('scoreVal').textContent = score;
  updateChaosLevel();
  const comboText = combo.multiplier > 1 ? ` (${combo.multiplier}x!)` : '';
  floatingTexts.push({ x, y: y-10, text: `+${finalPts} ${label}${comboText}`, life: 120, vy: -1.5 });
  if (pts >= 20) playSound('legendary');
  else playSound('smash');
  addCombo();
  totalDestroyed++;
  updateDestructionDisplay();
}
function updateDestructionDisplay() {
  const pct = totalDestructibles > 0 ? Math.round((totalDestroyed / totalDestructibles) * 100) : 0;
  document.getElementById('destructionVal').textContent = pct + '%';
}
function addLog(msg) { floatingTexts.push({ x: camera.x+CW/2, y: camera.y+CH-40, text: 'üòà '+msg, life: 150, vy: -0.5 }); }
function updateChaosLevel() {
  const el = document.getElementById('chaosVal');
  if (score < 10) el.textContent='üò¥ Napping';
  else if (score < 30) el.textContent='üòè Mischievous';
  else if (score < 60) el.textContent='üòº Chaotic';
  else if (score < 100) el.textContent='üî• Destructive';
  else if (score < 180) el.textContent='üí• CATASTROPHIC';
  else el.textContent='‚ò¢Ô∏è LEGENDARY';
}

// ===== PARTICLES =====
function spawnParticles(x, y, color, count, type='smash') {
  for (let i = 0; i < count; i++) {
    const angle = Math.random()*Math.PI*2;
    const speed = Math.random()*6+2;
    particles.push({
      x, y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed - 3,
      color, life: 40+Math.random()*30, maxLife: 70,
      size: type==='smoke'?8+Math.random()*8:type==='feather'?4+Math.random()*4:type==='confetti'?3+Math.random()*3:type==='shard'?2+Math.random()*4:3+Math.random()*5,
      type, rot: Math.random()*Math.PI*2, rotV: (Math.random()-0.5)*0.2
    });
  }
}
function spawnGlassShards(x, y, color, count) {
  for (let i = 0; i < count; i++) {
    const angle = Math.random()*Math.PI*2;
    const speed = Math.random()*5+1;
    particles.push({
      x, y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed-2,
      color, life: 50+Math.random()*30, maxLife: 80,
      size: 2+Math.random()*4, type:'shard', rot: Math.random()*Math.PI*2, rotV: (Math.random()-0.5)*0.3
    });
  }
  playSound('glass');
}
function spawnFeathers(x, y, color, count) {
  for (let i = 0; i < count; i++) {
    particles.push({
      x: x+(Math.random()-0.5)*20, y: y+(Math.random()-0.5)*10,
      vx: (Math.random()-0.5)*3, vy: -Math.random()*2-1,
      color, life: 80+Math.random()*40, maxLife: 120,
      size: 3+Math.random()*3, type:'feather', rot: Math.random()*Math.PI*2, rotV: (Math.random()-0.5)*0.1
    });
  }
  playSound('shred');
}
function spawnWaterSplash(x, y, count) {
  for (let i = 0; i < count; i++) {
    const angle = -Math.PI/2+(Math.random()-0.5)*Math.PI;
    const speed = Math.random()*4+2;
    particles.push({
      x, y, vx: Math.cos(angle)*speed, vy: Math.sin(angle)*speed,
      color: `rgba(52,152,219,${0.5+Math.random()*0.5})`, life: 30+Math.random()*20, maxLife: 50,
      size: 2+Math.random()*3, type:'water', rot:0, rotV:0
    });
  }
  playSound('splash');
}
function spawnConfetti(x, y, count) {
  const colors = ['#ff6b35','#ffdd00','#ff4500','#e056da','#3498db','#2ecc71'];
  for (let i = 0; i < count; i++) {
    particles.push({
      x, y, vx: (Math.random()-0.5)*6, vy: -Math.random()*4-2,
      color: colors[Math.floor(Math.random()*colors.length)],
      life: 60+Math.random()*40, maxLife: 100,
      size: 2+Math.random()*3, type:'confetti', rot: Math.random()*Math.PI*2, rotV: (Math.random()-0.5)*0.3
    });
  }
}
function spawnFireParticles(x, y) {
  const colors = ['#ff4500','#ff6b35','#ffdd00','#ff8c00'];
  for (let i = 0; i < 2; i++) {
    particles.push({
      x: x+(Math.random()-0.5)*20, y,
      vx: (Math.random()-0.5)*2, vy: -2-Math.random()*3,
      color: colors[Math.floor(Math.random()*colors.length)],
      life: 30+Math.random()*20, maxLife: 50, size: 6+Math.random()*8, type:'fire', rot:0, rotV:0
    });
  }
}
function updateParticles() {
  particles = particles.filter(p => p.life > 0);
  for (const p of particles) {
    p.x += p.vx; p.y += p.vy;
    if (p.type==='feather') { p.vy += 0.02; p.vx *= 0.99; p.vx += Math.sin(Date.now()*0.005+p.x)*0.05; }
    else if (p.type==='water') { p.vy += 0.25; }
    else if (p.type==='confetti') { p.vy += 0.08; p.vx *= 0.98; }
    else if (p.type!=='fire' && p.type!=='smoke') { p.vy += 0.2; }
    p.life--;
    p.rot += p.rotV || 0;
    if (p.type==='fire'||p.type==='smoke') p.size *= 0.97;
  }
  if (particles.length > 600) particles = particles.slice(-500);
}

// ===== COLLISION =====
function rectOverlap(a, b) {
  return a.x < b.x+b.w && a.x+a.w > b.x && a.y < b.y+b.h && a.y+a.h > b.y;
}

function getAllSolids() {
  let solids = [...walls];
  if (!puzzleState.secretRoomOpen) {
    const bs = platforms.find(p => p.blocksSecret);
    if (bs) solids.push({ x:bs.x, y:bs.y, w:bs.w, h:bs.h, solid:true });
  }
  if (!puzzleState.garageDoorOpen) {
    solids.push({ x:2790, y:1400, w:20, h:400, solid:true, color:'#8B7355', isGarageDoor:true });
  }
  if (!puzzleState.atticHatchOpen) {
    solids.push({ x:700, y:380, w:300, h:30, solid:true });
  }
  return solids;
}

function resolveCollisions(entity, ew, eh) {
  const solids = getAllSolids();
  const allPlatforms = [...platforms];
  for (const f of furniture) allPlatforms.push({ x:f.x, y:f.y, w:f.w, h:f.h });

  entity.onGround = false;
  if (entity === cat) entity.wallSlide = 0;

  for (const p of allPlatforms) {
    if (p.blocksSecret && puzzleState.secretRoomOpen) continue;
    if (entity.x+ew > p.x+2 && entity.x < p.x+p.w-2 &&
        entity.y+eh <= p.y+6 && entity.y+eh+entity.vy >= p.y-2) {
      if (entity.vy >= 0) {
        entity.y = p.y - eh;
        if (entity.vy > 8 && entity === cat) { cat.squish=8; spawnParticles(entity.x+ew/2, entity.y+eh, '#8B6F47', 4, 'dust'); }
        entity.vy = 0;
        entity.onGround = true;
      }
    }
  }

  for (const w of solids) {
    if (!rectOverlap({ x:entity.x, y:entity.y, w:ew, h:eh }, w)) continue;
    const oL=(entity.x+ew)-w.x, oR=(w.x+w.w)-entity.x, oT=(entity.y+eh)-w.y, oB=(w.y+w.h)-entity.y;
    const m = Math.min(oL,oR,oT,oB);
    if (m===oT && entity.vy>=0) { entity.y=w.y-eh; if(entity.vy>8&&entity===cat) cat.squish=8; entity.vy=0; entity.onGround=true; }
    else if (m===oB && entity.vy<=0) { entity.y=w.y+w.h; entity.vy=1; }
    else if (m===oL && entity.vx>=0) { entity.x=w.x-ew; if(entity===cat) entity.wallSlide=1; entity.vx=0; }
    else if (m===oR && entity.vx<=0) { entity.x=w.x+w.w; if(entity===cat) entity.wallSlide=-1; entity.vx=0; }
  }

  if (entity.y+eh > GROUND_Y) { entity.y=GROUND_Y-eh; entity.vy=0; entity.onGround=true; }
  if (entity.x < 0) { entity.x=0; entity.vx=0; if(entity===cat) entity.wallSlide=-1; }
  if (entity.x+ew > WORLD_W) { entity.x=WORLD_W-ew; entity.vx=0; }
}

// ===== CAT UPDATE =====
function updateCat() {
  if (gameState !== 'playing') return;

  // Climbing curtain?
  if (cat.climbing) {
    cat.climbTimer++;
    cat.y -= 2.5;
    cat.vx = 0; cat.vy = 0;
    cat.state = 'climb';
    if (cat.climbTimer % 6 === 0) playSound('climb');
    // Reached top?
    if (cat.y <= cat.climbing.topY - 10) {
      cat.climbing.climbed = true;
      cat.climbing.shredded = true;
      cat.climbing = null;
      cat.vy = -3;
      cat.onGround = false;
      addScore(4, 'Shredded curtains!', cat.x, cat.y);
      spawnParticles(cat.x, cat.y+cat.h, '#c0392b', 15, 'confetti');
      addLog('üßó Climbed & shredded curtains!');
    }
    return;
  }

  const speed = 4.0;
  const maxJumpPower = -11;
  const minJumpPower = -5.5;

  let onSlippery = false;
  for (const sz of slipperyZones) {
    if (rectOverlap({ x:cat.x, y:cat.y, w:cat.w, h:cat.h }, sz)) { onSlippery=true; break; }
  }
  const friction = onSlippery ? 0.98 : 0.7;

  if (keys['ArrowLeft']||keys['KeyA']) { cat.vx = onSlippery ? cat.vx-0.3 : -speed; cat.facing=-1; cat.state='walk'; }
  else if (keys['ArrowRight']||keys['KeyD']) { cat.vx = onSlippery ? cat.vx+0.3 : speed; cat.facing=1; cat.state='walk'; }
  else { cat.vx *= friction; if (cat.onGround) cat.state='idle'; }
  if (onSlippery) cat.vx = Math.max(-8, Math.min(8, cat.vx));

  // Pounce
  if (cat.pounce!==0 && cat.pounceTimer<=0) {
    cat.vx = cat.pounce*11; cat.pounceTimer=30; cat.pounce=0;
    cat.facing = cat.vx>0?1:-1; cat.stretch=8;
    playSound('pounce');
    spawnParticles(cat.x+cat.w/2, cat.y+cat.h/2, '#FFA500', 8, 'dust');
  }
  if (cat.pounceTimer>0) cat.pounceTimer--;
  cat.pounce = 0;

  // Jump
  const jumpKeys = keys['ArrowUp']||keys['KeyZ']||keys['KeyW']||keys['Space'];
  if (jumpKeys && cat.onGround) {
    cat.vy=maxJumpPower; cat.onGround=false; cat.jumpHeld=true; cat.jumpReleased=false; cat.jumpTime=0; cat.stretch=6;
    playSound('jump');
    spawnParticles(cat.x+cat.w/2, cat.y+cat.h, '#8B6F47', 5, 'dust');
  } else if (jumpKeys && cat.wallSlide!==0 && !cat.onGround && cat.jumpReleased) {
    cat.vy=-9; cat.vx=-cat.wallSlide*5.5; cat.facing=-cat.wallSlide; cat.jumpReleased=false; cat.stretch=5;
    playSound('jump');
    spawnParticles(cat.x+(cat.wallSlide>0?cat.w:0), cat.y+cat.h/2, '#c8a87a', 6, 'dust');
  }
  if (cat.jumpHeld && !jumpKeys) { cat.jumpHeld=false; if(cat.vy<minJumpPower) cat.vy=minJumpPower; }
  if (cat.jumpHeld) cat.jumpTime++;

  if (cat.wallSlide!==0 && !cat.onGround && cat.vy>0) {
    cat.vy = Math.min(cat.vy, 2); cat.state='wallslide';
    if (Math.random()<0.3) spawnParticles(cat.x+(cat.wallSlide>0?cat.w:0), cat.y+cat.h/2, '#c8a87a', 1, 'dust');
  }

  cat.vy += GRAVITY;
  cat.x += cat.vx;
  cat.y += cat.vy;
  if (cat.vy>0 && !cat.onGround) cat.state='jump';

  resolveCollisions(cat, cat.w, cat.h);
  if (cat.onGround && Math.abs(cat.vx)<0.3 && cat.state!=='push') cat.state='idle';

  // Interact
  if (keys['KeyE']) {
    cat.eHeld++;
    if (cat.onGround || cat.wallSlide!==0) cat.state='push';
  } else {
    cat.eHeld=0; cat.scratchTarget=null; cat.scratchProgress=0;
  }

  cat.tail = Math.sin(Date.now()*0.005)*15;
  if (cat.squish>0) cat.squish-=0.5;
  if (cat.stretch>0) cat.stretch-=0.4;
  if (cat.puffTail>0) cat.puffTail-=0.3;
  if (dogWarningTriggered && !dogChaseActive) cat.puffTail=5;
  if (cat.pushCooldown>0) cat.pushCooldown--;

  if (keys['KeyE'] && cat.pushCooldown===0) interactWithObjects();

  // Check curtain climbing
  if (jumpKeys && !cat.onGround && !cat.climbing) {
    for (const c of curtains) {
      if (c.climbed || c.shredded) continue;
      if (rectOverlap({ x:cat.x, y:cat.y, w:cat.w, h:cat.h }, { x:c.x, y:c.topY, w:c.w, h:c.h })) {
        cat.climbing = c; cat.climbTimer=0; cat.vx=0; cat.vy=0;
        addLog('üßó Climbing curtains!');
        break;
      }
    }
  }

  cat.frameTimer++;
  if (cat.frameTimer>8) { cat.frame=(cat.frame+1)%4; cat.frameTimer=0; }

  const room = getRoomAt(cat.x+cat.w/2, cat.y+cat.h/2);
  if (room) visitedRooms[room.name] = true;
}

function interactWithObjects() {
  const reach = { x:cat.x+(cat.facing>0?cat.w:-28), y:cat.y-5, w:32, h:cat.h+10 };

  // Push furniture
  for (const f of furniture) {
    if (f.pushable && rectOverlap(reach, f)) {
      f.vx = cat.facing*2.5;
      cat.pushCooldown = 8;
      playSound('push');
      // Check if reveals hidden item
      if (f.hidesItem && !f._revealed) {
        f._revealed = true;
        addLog('Found something hidden!');
        showWarning('üîç Hidden item revealed!', '#f1c40f');
      }
    }
  }

  for (const obj of objects) {
    if (obj.destroyed) continue;
    const objReach = { x:obj.x-10, y:obj.y-10, w:(obj.w||20)+20, h:(obj.h||20)+20 };
    if (!rectOverlap({ x:cat.x, y:cat.y, w:cat.w, h:cat.h }, objReach)) continue;

    // Collectables
    if (obj.collectable && !obj.destroyed) {
      obj.destroyed = true;
      if (obj.type==='lighter') { puzzleState.hasLighter=true; addLog('üî• Grabbed the lighter!'); }
      else if (obj.type==='key') { puzzleState.atticHatchOpen=true; addLog('üîë Attic hatch unlocked!'); playSound('unlock'); showWarning('üîë ATTIC UNLOCKED!', '#f1c40f'); }
      else if (obj.type==='clue') { puzzleState.cluesFound[obj.clueIndex]=obj.clueValue; addLog(`üìù Found clue: ${obj.label}`); playSound('unlock'); showWarning(obj.label, '#ffffcc'); }
      spawnParticles(obj.x+(obj.w||10)/2, obj.y+(obj.h||10)/2, obj.color, 12);
      cat.pushCooldown = 20;
      continue;
    }

    // Stove knob
    if (obj.type==='stoveknob' && !puzzleState.stoveOn) {
      puzzleState.stoveOn=true; obj.color='#2ecc71';
      addScore(5, 'Stove On!', obj.x, obj.y); addLog('üí® Gas is ON...');
      cat.pushCooldown=40; continue;
    }
    // Garage button
    if (obj.type==='button' && obj.id==='garagebtn' && !puzzleState.garageDoorOpen) {
      puzzleState.garageDoorOpen=true; addLog('üöó Garage door opened!');
      playSound('unlock'); showWarning('üöó GARAGE OPEN!', '#2ecc71'); cat.pushCooldown=40; continue;
    }
    // Safe
    if (obj.type==='safe' && !puzzleState.safeOpen) {
      if (puzzleState.cluesFound.length>=3 && puzzleState.cluesFound[0]===3 && puzzleState.cluesFound[1]===7 && puzzleState.cluesFound[2]===1) {
        puzzleState.safeOpen=true; addLog('üíé SAFE CRACKED OPEN!'); playSound('legendary');
        showWarning('üíé SAFE OPENED! JEWELRY!!!', '#f1c40f');
        objects.push({ id:'safe_jewelry', room:'Bedroom', type:'artifact', x:1810, y:1050, w:18, h:14, destroyed:false, pts:40, color:'#f1c40f', label:'üíé JEWELRY', pushable:true, vx:0, vy:0, smashable:true });
        totalDestructibles++; cat.pushCooldown=40;
      } else { showWarning('üîí Need combo! Find 3 clue notes!', '#ff4500'); cat.pushCooldown=30; }
      continue;
    }
    // Faucet
    if (obj.isFaucet && !puzzleState.bathroomFlooded && obj.pushable) {
      obj.vx = cat.facing*4;
      if (!obj._knockedOnce) {
        obj._knockedOnce = true;
        setTimeout(() => {
          if (gameState!=='playing') return;
          puzzleState.bathroomFlooded=true;
          addScore(5, 'Flooded bathroom!', 400, 950);
          addLog('üåä BATHROOM FLOODED!'); playSound('water');
          showWarning('üåä BATHROOM FLOODED!', '#3498db');
          slipperyZones.push({ x:0, y:950, w:700, h:50 });
          spawnWaterSplash(400, 950, 30);
        }, 1000);
      }
      cat.pushCooldown=15; continue;
    }
    // Light fire
    if (obj.type==='stoveknob' && puzzleState.stoveOn && puzzleState.hasLighter && !puzzleState.fireStarted) {
      puzzleState.fireStarted=true; triggerFire(); cat.pushCooldown=40; continue;
    }

    // Unrollable (toilet paper, paper towels)
    if (obj.unrollable && !obj.destroyed && cat.eHeld > 3) {
      obj.destroyed = true;
      addScore(obj.pts, `Unrolled ${obj.label}!`, obj.x, obj.y);
      spawnConfetti(obj.x+obj.w/2, obj.y, 20);
      playSound('unroll');
      if (obj.room) roomDestructionMap[obj.room].destroyed++;
      cat.pushCooldown = 15;
      continue;
    }

    // Shreddable (pillows)
    if (obj.shreddable && !obj.destroyed && cat.eHeld > 10) {
      obj.destroyed = true;
      addScore(obj.pts, `Shredded ${obj.label}!`, obj.x, obj.y);
      spawnFeathers(obj.x+obj.w/2, obj.y+obj.h/2, obj.color, 20);
      if (obj.room) roomDestructionMap[obj.room].destroyed++;
      cat.pushCooldown = 15;
      continue;
    }

    // Scratchable
    if (obj.scratchable && cat.eHeld>5 && !obj.destroyed) {
      cat.scratchTarget = obj;
      cat.scratchProgress++;
      if (cat.scratchProgress%10===0) playSound('scratch');
      if (cat.scratchProgress >= (obj.scratchTime||30)) {
        obj.destroyed = true;
        addScore(obj.pts, `Destroyed ${obj.label}!`, obj.x, obj.y);
        spawnParticles(obj.x+(obj.w||20)/2, obj.y+(obj.h||20)/2, obj.color, 25);
        if (obj.room) roomDestructionMap[obj.room].destroyed++;
        cat.pushCooldown=20; cat.scratchTarget=null; cat.scratchProgress=0;
      }
      continue;
    }

    // Pushable
    if (obj.pushable && !obj.destroyed) {
      obj.vx = cat.facing * (obj.heavy ? 1.5 : 3.5);
      cat.pushCooldown = 10;
      if (obj.isBookshelfBook) {
        obj.isBookshelfBook = false;
        puzzleState.booksRemoved++;
        if (puzzleState.booksRemoved >= puzzleState.totalBooks) {
          puzzleState.secretRoomOpen=true; addLog('üìö Secret room revealed!');
          playSound('legendary'); showWarning('üîÆ SECRET ROOM DISCOVERED!', '#9b59b6');
        }
      }
    }
  }
}

// ===== OBJECT & FURNITURE PHYSICS =====
function updateObjects() {
  for (const obj of objects) {
    if (obj.destroyed || obj.fixed || !obj.pushable) continue;
    obj.vx = (obj.vx||0) * 0.85;
    obj.vy = (obj.vy||0) + GRAVITY;
    obj.x += obj.vx; obj.y += obj.vy;
    const prevGround = obj.onGround;
    resolveCollisions(obj, obj.w, obj.h);

    if (obj.onGround && !prevGround && Math.abs(obj.vy) > 3 && obj.smashable) {
      obj.destroyed = true;
      addScore(obj.pts, `Smashed ${obj.label}!`, obj.x+obj.w/2, obj.y);
      if (obj.type==='glass'||obj.type==='vase'||obj.type==='fishbowl') {
        spawnGlassShards(obj.x+obj.w/2, obj.y, obj.color, 15);
        glassShards.push({ x:obj.x-5, y:obj.y+obj.h, w:obj.w+10, h:4, color:obj.color, life:600 });
      } else {
        spawnParticles(obj.x+obj.w/2, obj.y, obj.color, 20);
      }
      if (obj.type==='fishbowl') spawnWaterSplash(obj.x+obj.w/2, obj.y, 20);
      if (obj.room) roomDestructionMap[obj.room].destroyed++;
    }
    if (obj.x<0) { obj.x=0; obj.vx=Math.abs(obj.vx); }
    if (obj.x+obj.w>WORLD_W) { obj.x=WORLD_W-obj.w; obj.vx=-Math.abs(obj.vx); }
  }
  // Books/soft items that hit ground count
  for (const obj of objects) {
    if (obj.destroyed || obj.fixed) continue;
    if ((obj.type==='book'||obj.type==='keyboard') && !obj.smashable && obj.onGround && obj.y>GROUND_Y-30 && !obj._counted) {
      obj._counted = true; obj.destroyed = true;
      addScore(obj.pts, `Knocked ${obj.label}!`, obj.x, obj.y);
      if (obj.room) roomDestructionMap[obj.room].destroyed++;
    }
  }
}

function updateFurniture() {
  for (const f of furniture) {
    f.vx = (f.vx||0) * 0.85;
    f.vy = (f.vy||0) + GRAVITY;
    f.x += f.vx; f.y += f.vy;
    resolveCollisions(f, f.w, f.h);
  }
}

// ===== FIRE =====
function triggerFire() {
  if (fireActive) return;
  fireActive=true;
  addScore(50, 'üî• HOUSE ON FIRE!!!', 1650, GROUND_Y-150);
  addLog('üî•üî•üî• MAXIMUM CHAOS!!! üî•üî•üî•');
  playSound('fire'); showWarning('üî• THE HOUSE IS ON FIRE! üî•', '#ff2200');
  let bonus = setInterval(() => {
    if (!fireActive || gameState!=='playing') { clearInterval(bonus); return; }
    fireSpread++;
    if (fireSpread%5===0) addScore(3, 'üî• Fire!', 1650+Math.random()*200, GROUND_Y-100);
    if (fireSpread>40) clearInterval(bonus);
  }, 1000);
}

// ===== WARNINGS =====
function showWarning(text, color) {
  const el = document.getElementById('warningBanner');
  el.textContent = text; el.style.color = color||'#ff2200'; el.style.opacity='1';
  setTimeout(() => { el.style.opacity='0'; }, 3000);
}

function updateWarnings() {
  if (timeLeft<=60 && !ownerWarningTriggered) {
    ownerWarningTriggered=true; showWarning('‚ö†Ô∏è OWNER COMING HOME IN 60 SECONDS!', '#ff6b35'); playSound('warning');
  }
  if (timeLeft<=30 && !dogWarningTriggered) {
    dogWarningTriggered=true; showWarning('üêï DOG LET OUT OF CRATE IN 30s!', '#ff2200'); playSound('warning'); cat.puffTail=10;
  }
  if (timeLeft<=15 && !dogChaseActive) {
    dogChaseActive=true; dogX=0; dogY=GROUND_Y-40;
    showWarning('üêï WOOF WOOF! DOG IS CHASING YOU!', '#ff0000'); playSound('warning');
  }
  if (dogChaseActive) {
    const dx = cat.x-dogX;
    dogX += dx*0.02; dogY = cat.y;
    if (Math.abs(dogX-cat.x)<40 && Math.abs(dogY-cat.y)<40) {
      timeLeft = Math.max(0, timeLeft-2);
      dogX = cat.x-cat.facing*200;
      showWarning('üêï CAUGHT! Lost 2 seconds!', '#ff0000');
      spawnParticles(cat.x, cat.y, '#8B4513', 15);
    }
  }
}

// ===== CAMERA =====
function updateCamera() {
  const targetX = cat.x+cat.w/2-CW/2;
  const targetY = cat.y+cat.h/2-CH/2;
  camera.x += (targetX-camera.x)*0.08;
  camera.y += (targetY-camera.y)*0.08;
  camera.x = Math.max(-100, Math.min(WORLD_W-CW+100, camera.x));
  camera.y = Math.max(-100, Math.min(WORLD_H-CH, camera.y));
}

// ===== DRAWING =====
function drawBackground() {
  const skyGrad = ctx.createLinearGradient(0,0,0,CH);
  skyGrad.addColorStop(0,'#1a0a2e'); skyGrad.addColorStop(1,'#2c1654');
  ctx.fillStyle = skyGrad; ctx.fillRect(0,0,CW,CH);

  ctx.save();
  ctx.translate(-camera.x, -camera.y);

  for (const r of rooms) {
    if (r.name==='Secret Room' && !puzzleState.secretRoomOpen) continue;
    if (r.name==='Attic' && !puzzleState.atticHatchOpen) continue;

    ctx.fillStyle = r.wall; ctx.fillRect(r.x, r.y, r.w, r.h);
    ctx.strokeStyle = r.wallAccent; ctx.lineWidth=1;
    for (let x=r.x; x<r.x+r.w; x+=50) { ctx.beginPath(); ctx.moveTo(x,r.y); ctx.lineTo(x,r.y+r.h); ctx.stroke(); }
    ctx.fillStyle = r.floor; ctx.fillRect(r.x, r.y+r.h-40, r.w, 40);
    ctx.strokeStyle = 'rgba(0,0,0,0.1)'; ctx.lineWidth=1;
    for (let x=r.x; x<r.x+r.w; x+=70) { ctx.beginPath(); ctx.moveTo(x,r.y+r.h-40); ctx.lineTo(x,r.y+r.h); ctx.stroke(); }
    ctx.fillStyle = 'rgba(0,0,0,0.05)'; ctx.font='bold 50px Bangers'; ctx.textAlign='center';
    ctx.fillText(r.name.toUpperCase(), r.x+r.w/2, r.y+r.h/2);
  }

  // Windows
  const drawWin = (x,y,w,h) => {
    const sky=ctx.createLinearGradient(x,y,x,y+h);
    sky.addColorStop(0,'#87ceeb'); sky.addColorStop(1,'#b0e0ff');
    ctx.fillStyle=sky; ctx.fillRect(x,y,w,h);
    ctx.fillStyle='rgba(255,255,255,0.7)';
    ctx.beginPath(); ctx.ellipse(x+w*0.3,y+h*0.3,15,8,0,0,Math.PI*2); ctx.fill();
    ctx.strokeStyle='#8B6F47'; ctx.lineWidth=4; ctx.strokeRect(x,y,w,h);
    ctx.beginPath(); ctx.moveTo(x+w/2,y); ctx.lineTo(x+w/2,y+h); ctx.stroke();
    ctx.beginPath(); ctx.moveTo(x,y+h/2); ctx.lineTo(x+w,y+h/2); ctx.stroke();
  };
  // Living room windows
  drawWin(130,1190,140,120); drawWin(810,1190,140,120);
  // Kitchen window
  drawWin(1300,1190,140,120);
  // Bathroom window
  drawWin(210,530,120,100);
  // Bedroom windows
  drawWin(1310,510,180,140); drawWin(1710,510,140,120);
  // Laundry window
  drawWin(2410,1190,140,120);

  // Bathroom tiles
  ctx.fillStyle='rgba(150,200,220,0.15)';
  for (let tx=0; tx<700; tx+=35) for (let ty=400; ty<1100; ty+=35) { if((tx+ty)%70===0) ctx.fillRect(tx,ty,33,33); }

  // Bathroom flood
  if (puzzleState.bathroomFlooded) {
    ctx.fillStyle='rgba(52,152,219,0.3)'; ctx.fillRect(0,960,700,70);
    ctx.strokeStyle='rgba(52,152,219,0.4)'; ctx.lineWidth=2;
    for (let wx=0; wx<700; wx+=30) {
      const wy=970+Math.sin(Date.now()*0.003+wx*0.1)*4;
      ctx.beginPath(); ctx.moveTo(wx,wy); ctx.quadraticCurveTo(wx+15,wy-3,wx+30,wy); ctx.stroke();
    }
  }

  // Garage floor
  ctx.fillStyle='rgba(255,255,0,0.2)'; ctx.fillRect(3000,GROUND_Y-5,350,5);

  // Walls
  for (const w of getAllSolids()) { if(w.color) { ctx.fillStyle=w.color; ctx.fillRect(w.x,w.y,w.w,w.h); } }

  // Baseboards
  ctx.fillStyle='#c8a87a'; ctx.fillRect(0,GROUND_Y-8,3700,8);

  // Doorway frames
  const drawDoor = (x,y,w,h) => { ctx.fillStyle='#5a3a1a'; ctx.fillRect(x,y,w,6); ctx.fillRect(x,y,4,h); ctx.fillRect(x+w-4,y,4,h); };
  drawDoor(990,1400,20,140); drawDoor(1890,1380,20,160); drawDoor(690,860,20,140);
  drawDoor(990,820,20,140);

  ctx.restore();
}

function drawPlatforms() {
  ctx.save(); ctx.translate(-camera.x,-camera.y);
  for (const p of platforms) {
    if (p.blocksSecret && puzzleState.secretRoomOpen) continue;
    ctx.fillStyle = p.color; ctx.fillRect(p.x,p.y,p.w,p.h);
    ctx.fillStyle='rgba(0,0,0,0.15)'; ctx.fillRect(p.x,p.y+p.h-3,p.w,3);

    if (p.type==='shelf') {
      ctx.fillStyle='#4a3020';
      ctx.fillRect(p.x+10,p.y+p.h,6,12); ctx.fillRect(p.x+p.w-16,p.y+p.h,6,12);
    }
    if (p.type==='sofa') {
      ctx.fillStyle='#8B4513';
      ctx.fillRect(p.x,p.y-15,16,p.h+15); ctx.fillRect(p.x+p.w-16,p.y-15,16,p.h+15);
      ctx.fillStyle='#C0A882';
      ctx.fillRect(p.x+20,p.y+6,100,20); ctx.fillRect(p.x+p.w-120,p.y+6,100,20);
    }
    if (p.type==='bed') {
      ctx.fillStyle='#5a4aad'; ctx.fillRect(p.x,p.y-30,24,p.h+30);
      ctx.fillStyle='#7a6aed'; ctx.fillRect(p.x+8,p.y-22,12,12);
      ctx.fillStyle='rgba(106,90,205,0.5)'; ctx.fillRect(p.x+30,p.y+5,p.w-40,p.h-10);
    }
    if (p.type==='stove') {
      ctx.fillStyle = puzzleState.stoveOn?'#ff4500':'#555';
      const cx=p.x, cy=p.y;
      [cx+25,cx+60,cx+25,cx+60].forEach((bx,i) => {
        const by = i<2?cy+12:cy+30;
        ctx.beginPath(); ctx.arc(bx,by,8,0,Math.PI*2); ctx.fill();
      });
    }
    if (p.type==='car') {
      ctx.fillStyle='#a02020'; ctx.fillRect(p.x+30,p.y-40,p.w-60,40);
      ctx.fillStyle='#87ceeb'; ctx.fillRect(p.x+50,p.y-35,80,28); ctx.fillRect(p.x+180,p.y-35,80,28);
      ctx.fillStyle='#333';
      ctx.beginPath(); ctx.arc(p.x+60,p.y+p.h,18,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(p.x+p.w-60,p.y+p.h,18,0,Math.PI*2); ctx.fill();
      ctx.fillStyle='#888';
      ctx.beginPath(); ctx.arc(p.x+60,p.y+p.h,9,0,Math.PI*2); ctx.fill();
      ctx.beginPath(); ctx.arc(p.x+p.w-60,p.y+p.h,9,0,Math.PI*2); ctx.fill();
    }
    if (p.type==='counter') { ctx.fillStyle='rgba(0,0,0,0.08)'; ctx.fillRect(p.x,p.y-2,p.w,2);
      // Cabinet underneath
      ctx.fillStyle='rgba(139,111,71,0.4)'; ctx.fillRect(p.x+5,p.y+p.h,p.w-10,70);
      ctx.strokeStyle='rgba(0,0,0,0.1)'; ctx.lineWidth=1; ctx.strokeRect(p.x+5,p.y+p.h,p.w-10,70);
    }
    if (p.type==='toilet') {
      ctx.fillStyle='#ecf0f1';
      ctx.fillRect(p.x+10,p.y+p.h,p.w-20,60);
      ctx.beginPath(); ctx.ellipse(p.x+p.w/2,p.y+p.h/2,p.w/2+2,p.h/2+2,0,0,Math.PI*2);
      ctx.strokeStyle='#bdc3c7'; ctx.lineWidth=2; ctx.stroke();
    }
    if (p.type==='tub') {
      ctx.fillStyle='#ecf0f1'; ctx.fillRect(p.x-6,p.y,6,100); ctx.fillRect(p.x+p.w,p.y,6,100);
      ctx.fillRect(p.x-6,p.y+96,p.w+12,8);
      ctx.fillStyle='rgba(52,152,219,0.3)'; ctx.fillRect(p.x,p.y+12,p.w,84);
    }
    if (p.blocksSecret && !puzzleState.secretRoomOpen) {
      ctx.fillStyle='#3a2010';
      for (let sy=p.y; sy<p.y+p.h; sy+=80) ctx.fillRect(p.x,sy,p.w,4);
    }
    if (p.type==='pedestal') { ctx.fillStyle='#6a0090'; ctx.fillRect(p.x+5,p.y-5,p.w-10,5); }
    if (p.type==='appliance') {
      ctx.fillStyle='#ddd'; ctx.fillRect(p.x,p.y+p.h,p.w,74);
      ctx.fillStyle='#aaa'; ctx.beginPath(); ctx.arc(p.x+p.w/2,p.y+p.h+37,20,0,Math.PI*2); ctx.fill();
      ctx.strokeStyle='#999'; ctx.lineWidth=2; ctx.beginPath(); ctx.arc(p.x+p.w/2,p.y+p.h+37,20,0,Math.PI*2); ctx.stroke();
    }
  }
  ctx.restore();
}

function drawFurniture() {
  ctx.save(); ctx.translate(-camera.x,-camera.y);
  for (const f of furniture) {
    ctx.fillStyle='rgba(0,0,0,0.1)'; ctx.fillRect(f.x+3,f.y+f.h,f.w-3,4);
    ctx.fillStyle = f.color; ctx.fillRect(f.x,f.y,f.w,f.h);
    ctx.strokeStyle='rgba(0,0,0,0.2)'; ctx.lineWidth=1; ctx.strokeRect(f.x,f.y,f.w,f.h);
    // Label when close
    const d = Math.hypot(cat.x-f.x, cat.y-f.y);
    if (d < 80) {
      ctx.fillStyle='rgba(255,220,0,0.7)'; ctx.font='bold 8px Fredoka One'; ctx.textAlign='center';
      ctx.fillText(f.label, f.x+f.w/2, f.y-6);
    }
  }
  ctx.restore();